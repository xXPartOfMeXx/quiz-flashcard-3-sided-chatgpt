<!DOCTYPE html>
<html lang="en">
<head>
  <meta name="viewport" content="width=device-width, initial-scale=0.8">
  <meta charset="UTF-8">
  <title>MCQ Quiz from CSV</title>
  <style>
	  /* Make form labels and inputs bigger */
	label {
	  font-size: 1.0rem;      /* üîº bigger text for ‚ÄúS·ªë c√¢u h·ªèi‚Äù, etc. */
	  font-weight: 600;
	}

	input[type="number"],
	input[type="file"] {
	  font-size: 1.0rem;      /* slightly smaller than label but readable */
	  padding: 4px 6px;
	  margin-top: 5px;
	}

	#timerDisplay {
	  position: fixed;
	  top: 20px;             /* distance from top edge */
	  right: 30px;           /* distance from right edge */
	  background-color: #fff3cd;
	  border: 2px solid #ffc107;
	  color: #d9534f;
	  padding: 10px 15px;
	  border-radius: 10px;
	  font-weight: bold;
	  font-size: 2rem;
	  box-shadow: 0 2px 6px rgba(0,0,0,0.2);
	  z-index: 1000;
	}

	.replay-btn {
	  position: fixed;       /* makes it stay in place when scrolling */
	  box-shadow: none !important;       /* üí• remove any shadow */
	  outline: none !important;          /* remove focus outline */
	  bottom: 20px;          /* distance from bottom edge */
	  right: 20px;           /* distance from right edge */
	  padding: 12px 18px;
	  background: none;
	  border: none;
	  color: white;
	  width: 100px;
	  height: 100px;	
	  font-size: 4rem;
	  border: none;
	  cursor: pointer;
	  box-shadow: 0 4px 6px rgba(0,0,0,0.2);
	  z-index: 1000;         /* ensures it stays above other content */
	  opacity: 0.9;
	  transition: all 0.2s ease;
	}

	.replay-btn:hover {
	  opacity: 1;
	  background:none;
	  box-shadow: none;       /* üí• remove any shadow */
	  outline: none;          /* remove focus outline */
	  transform: scale(1.1);
	}

    body { font-family: Arial, sans-serif; margin: 30px; background: #f9f9f9; }
    h2 { margin-top: 20px; }
	.subtitle {
      font-size: 0.9rem;
      color: #555;
      font-style: italic;
      margin-bottom: 15px;
      margin-left: 20px;
    }
	.rednotething {
      margin-left: 20px; 
      font-size:0.9rem; 
      font-style:italic; 
      font-weight:bold; 
      color:#FF0000;
    }
	.rednotethingbig {
      margin-left: 20px; 
      font-size:1.2rem; 
      font-style:italic; 
      font-weight:bold; 
      color:#FF0000;
    }
    .question-box { background: #fff; padding: 20px; margin-bottom: 15px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
    .answers button { display: block; margin: 5px 0; padding: 16px 20px; font-size: 1.5rem; width: 100%; border: 1px solid #ccc; border-radius: 5px; background: #eee; cursor: pointer; }
    .answers button:hover {transform: scale(1.05);font-size: 1.7rem;}
    .correct { background: #c8f7c5 !important; border-color: #27ae60 !important; }
    .wrong { background: #f7c5c5 !important; border-color: #e74c3c !important; }
    .feedback { margin-top: 10px; font-weight: bold; white-space: pre-line; }
    #scoreBox { margin-top: 30px; padding: 15px; background: #fff; border-radius: 8px; font-size: 1.2em; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
  
	  /* Make answer buttons smaller on phones */
	@media (max-width: 600px) {
	  .answers button {
		font-size: 1rem;      /* smaller text */
		padding: 8px 10px;    /* less vertical padding */
	  }
	  .replay-btn {
		position: fixed;
		box-shadow: none;       /* üí• remove any shadow */
		outline: none;          /* remove focus outline */
		bottom: 20px;
		right: 20px;
		background: none;         /* transparent background */
		border: none;             /* remove border */
		color: #007bff;           /* icon color */
		font-size: 3.5rem;       /* icon size */
		cursor: pointer;
		z-index: 1000;
		transition: transform 0.2s ease, color 0.2s ease;
		opacity: 0.9;
	  }
	}

  </style>
</head>
<body>
  <h1 style="text-align:center;">√îN T·∫¨P FLASHCARD 3 M·∫∂T</h1>
  <h2 id="timerDisplay">‚è±Ô∏è 00:00</h2>
  <p class="subtitle">
    Ch·ªçn s·ªë c√¢u h·ªèi r·ªìi t·∫£i l√™n file [*.csv] ƒë·ªÉ b·∫Øt ƒë·∫ßu.
  </p>
  <p class="rednotething">
    *FORMAT B·∫ÆT BU·ªòC: [ƒê·ªÅ,C√¢u tr·∫£ l·ªùi,L√Ω gi·∫£i] t∆∞∆°ng ·ª©ng v·ªõi [Face1,Face2,Face3]<br><br>
    Xem l·∫°i v√† ch·ªânh s·ª≠a flashcard 3 m·∫∑t <a href="https://xxpartofmexx.github.io/3faceflashcard-creator/" target="_blank">t·∫°i ƒë√¢y</a>. (h·ªó tr·ª£ ƒëi·ªán tho·∫°i nh∆∞ng x·∫•u...)
  </p>
  <p class="subtitle">Made entirely in ChatGPT (super OP) from Panana Astley</p>
  <p class="rednotethingbig">‚ùó‚ùó SAU KHI T·∫¢I FILE L√äN TH√å PH·∫¢I NH·∫§N üîÅ √çT NH·∫§T 1 L·∫¶N TR∆Ø·ªöC KHI B·∫ÆT ƒê·∫¶U (c√≥ th·ªÉ c√≥ bug) ‚ùó‚ùó</p>
  <label style="margin-left: 20px;" for="limitInput">S·ªë c√¢u h·ªèi: </label>
  <input type="number" id="limitInput" min="1" style="width:70px"><br>
  <label style="margin-left: 20px;" for="timeInput">Th·ªùi gian l√†m b√†i (ph√∫t): </label>
  <input type="number" id="timeInput" min="0.1" step="0.1" style="width:80px"><br>
  <button id="replayBtn" class="replay-btn" style="display:none;" title="Ch∆°i l·∫°i">üîÅ</button>
  <p style="font-size: 1.2rem; margin-left: 20px;">
    T·∫£i l√™n file [*.csv]:<br>
    <input style="font-size: 1.1rem;" type="file" id="csvFile" accept=".csv">
  </p>

  <br><br>
  <div id="quiz"></div>
  <div id="scoreBox"></div>

<script>
let timerInterval = null;
let quizEnded = false;
let remainingSeconds = 0;
let quizStartTime = null;

// üß© NEW global score tracking
let correctCountGlobal = 0;
let totalQuestionsGlobal = 0;

const replayBtn = document.getElementById("replayBtn");
let lastCSVData = null;
let lastQuestionLimit = null;

// ========== Helpers ==========
function parseCSV(text) {
  return text.trim().split("\n").map(line => line.split(","));
}
function shuffle(array) {
  for (let i = array.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [array[i], array[j]] = [array[j], array[i]];
  }
  return array;
}

// ========== Build Quiz ==========
function buildQuiz(data) {
  const quizContainer = document.getElementById("quiz");
  const scoreBox = document.getElementById("scoreBox");
  quizContainer.innerHTML = "";
  scoreBox.innerHTML = "";

  let correctCount = 0;
  let answeredCount = 0;

  const limit = parseInt(document.getElementById("limitInput").value) || data.length;
  const totalQuestions = Math.min(limit, data.length);
  totalQuestionsGlobal = totalQuestions; // store globally

  // --- TIMER SETUP ---
  const timerDisplay = document.getElementById("timerDisplay");
  clearInterval(timerInterval);
  timerInterval = null;
  timerDisplay.style.display = "none";
  quizEnded = false;

  const timeLimitMinutes = parseFloat(document.getElementById("timeInput").value);
  if (timeLimitMinutes && timeLimitMinutes > 0) {
    remainingSeconds = timeLimitMinutes * 60;
    quizStartTime = Date.now();
    timerDisplay.style.display = "block";
    updateTimerDisplay();

    timerInterval = setInterval(() => {
      if (quizEnded) {
        clearInterval(timerInterval);
        timerInterval = null;
        return;
      }
      remainingSeconds--;
      updateTimerDisplay();
      if (remainingSeconds <= 0) {
        clearInterval(timerInterval);
        timerInterval = null;
        quizEnded = true;
        // üëá use global score
        correctCountGlobal = correctCount;
        endQuizEarly();
      }
    }, 1000);
  } else {
    quizStartTime = Date.now();
  }

  const selectedQuestions = shuffle([...data]).slice(0, totalQuestions);
  const allAnswers = data.map(d => d[1]);

  selectedQuestions.forEach(([question, correctAnswer, definition], qIndex) => {
    const questionBox = document.createElement("div");
    questionBox.className = "question-box";

    const qText = document.createElement("h2");
    qText.textContent = `Q${qIndex + 1}: ${question}`;
    questionBox.appendChild(qText);

    // Unique answers
    const uniqueAnswers = new Set();
    uniqueAnswers.add(correctAnswer.toLowerCase());
    shuffle(allAnswers).forEach(a => {
      if (uniqueAnswers.size < 4 &&
          a.toLowerCase() !== correctAnswer.toLowerCase() &&
          !uniqueAnswers.has(a.toLowerCase())) {
        uniqueAnswers.add(a.toLowerCase());
      }
    });
    const options = shuffle(
      [...uniqueAnswers].map(txt =>
        allAnswers.find(a => a.toLowerCase() === txt) || txt
      )
    );

    const answersDiv = document.createElement("div");
    answersDiv.className = "answers";
    const feedback = document.createElement("div");
    feedback.className = "feedback";

    options.forEach(option => {
      const btn = document.createElement("button");
      btn.textContent = option;

      btn.onclick = () => {
        [...answersDiv.children].forEach(b => b.disabled = true);

        if (quizEnded) {
          // Time's up ‚Üí show feedback only
          if (option.trim().toLowerCase() === correctAnswer.trim().toLowerCase()) {
            btn.classList.add("correct");
            feedback.textContent = `‚úÖ Correct!\nDefinition: ${definition}`;
            feedback.style.color = "green";
          } else {
            btn.classList.add("wrong");
            feedback.textContent = `‚ùå Wrong.\nCorrect answer: ${correctAnswer}\nDefinition: ${definition}`;
            feedback.style.color = "red";
          }
          return;
        }

        // Normal answer
        if (option.trim().toLowerCase() === correctAnswer.trim().toLowerCase()) {
          btn.classList.add("correct");
          feedback.textContent = `‚úÖ Correct!\nDefinition: ${definition}`;
          feedback.style.color = "green";
          correctCount++;
        } else {
          btn.classList.add("wrong");
          feedback.textContent = `‚ùå Wrong.\nCorrect answer: ${correctAnswer}\nDefinition: ${definition}`;
          feedback.style.color = "red";
        }

        answeredCount++;

        if (answeredCount === totalQuestions) {
          quizEnded = true;
          clearInterval(timerInterval);
          timerInterval = null;
          correctCountGlobal = correctCount;
          endQuizEarly();
        }
      };

      answersDiv.appendChild(btn);
    });

    questionBox.appendChild(answersDiv);
    questionBox.appendChild(feedback);
    quizContainer.appendChild(questionBox);
  });
}

// ========== Timer Display ==========
function updateTimerDisplay() {
  const timerDisplay = document.getElementById("timerDisplay");
  const mins = Math.floor(remainingSeconds / 60);
  const secs = remainingSeconds % 60;
  timerDisplay.textContent = `‚è±Ô∏è ${mins.toString().padStart(2,"0")}:${secs.toString().padStart(2,"0")}`;
}

// ========== End Quiz Early ==========
function endQuizEarly() {
  const scoreBox = document.getElementById("scoreBox");
  const timerDisplay = document.getElementById("timerDisplay");

  clearInterval(timerInterval);
  timerInterval = null;
  timerDisplay.style.display = "none";
  quizEnded = true;

  const totalTime = ((Date.now() - quizStartTime) / 1000).toFixed(1);
  const percentage = Math.round((correctCountGlobal / totalQuestionsGlobal) * 100);

  // ‚úÖ Check if the user actually set a timer
  const timeLimitInput = parseFloat(document.getElementById("timeInput").value);

  let timeMessage;
  if (timeLimitInput && remainingSeconds <= 0) {
    // only show easter egg if timer was set and time ran out
    timeMessage = "YOU'RE TAKING TOO LONG üéÉ";
  } else {
    timeMessage = `Th·ªùi gian l√†m b√†i: ${totalTime} gi√¢y`;
  }

  let resultMessage = "";
  if (percentage >= 75) {
    resultMessage = `Final Score: ${correctCountGlobal}/${totalQuestionsGlobal} (${percentage}%). You‚Äôre a genius! üéâüéâ`;
  } else if (percentage >= 50 && percentage < 75) {
    resultMessage = `Final Score: ${correctCountGlobal}/${totalQuestionsGlobal} (${percentage}%). Congratulations! üéâ`;
  } else if (percentage > 0 && percentage < 50) {
    resultMessage = `Final Score: ${correctCountGlobal}/${totalQuestionsGlobal} (${percentage}%). We Asians are disappointed in you üò°üëø`;
  } else {
    resultMessage = `ARE YOU DUMB?`;
  }

  scoreBox.innerHTML = `${resultMessage}<br>${timeMessage}`;
}


// ========== CSV Loader & Replay ==========
function startQuizFromCSV(text) {
  const data = parseCSV(text);
  buildQuiz(data);
}

document.getElementById("csvFile").addEventListener("change", e => {
  const file = e.target.files[0];
  if (!file) return;
  const reader = new FileReader();
  reader.onload = evt => {
    const text = evt.target.result;
    lastCSVData = text;
    lastQuestionLimit = parseInt(document.getElementById("limitInput").value) || null;
    replayBtn.style.display = "inline-block";
    startQuizFromCSV(text);
  };
  reader.readAsText(file);
});

replayBtn.addEventListener("click", () => {
  if (lastCSVData) {
    window.scrollTo({ top: 0, behavior: "smooth" });
    document.getElementById("quiz").innerHTML = "";
    document.getElementById("scoreBox").textContent = "";
    document.getElementById("timerDisplay").style.display = "none";
    clearInterval(timerInterval);
    timerInterval = null;
    quizEnded = false;
    correctCountGlobal = 0;
    totalQuestionsGlobal = 0;

    if (lastQuestionLimit) {
      document.getElementById("limitInput").value = lastQuestionLimit;
    }

    startQuizFromCSV(lastCSVData);
  }
});

function updateTimerDisplay() {
  const timerDisplay = document.getElementById("timerDisplay");
  const mins = Math.floor(remainingSeconds / 60);
  const secs = remainingSeconds % 60;
  timerDisplay.textContent = `‚è±Ô∏è ${mins.toString().padStart(2,"0")}:${secs.toString().padStart(2,"0")}`;
  
  // Flash red in last 10 seconds
  if (remainingSeconds <= 10) {
    timerDisplay.style.backgroundColor = "#f8d7da";
    timerDisplay.style.borderColor = "#dc3545";
    timerDisplay.style.color = "#b30000";
  } else {
    timerDisplay.style.backgroundColor = "#fff3cd";
    timerDisplay.style.borderColor = "#ffc107";
    timerDisplay.style.color = "#d9534f";
  }
}

</script>

</body>
</html>
